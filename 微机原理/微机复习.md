[TOC]



# 考前速记

**芯片的存储容量＝存储单元数×存储单元的位数＝2^M^×N**

- **M**：芯片的**地址引脚个数**

- **N**：芯片的**数据引脚个数** 

**同样存储结构的芯片构成一定容量的存储器模块**

![image-20211212222806552](微机复习.assets\image-20211212222806552.png)

如64K×1存储结构的芯片构成512KB存储器模块

![image-20211212222838079](微机复习.assets\image-20211212222838079.png)

查询传送

```assembly
; 查询输入接口
mov dx, 5001h       ;DX指向状态端口
STATUS: in al, dx   ;读状态端口
        test al, 01h;测试标志位D0
        jz STATUS   ;D0 = 0，未准备好，继续查询
        dec dx      ;D0 = 1 准备好，DX-1,指向数据端口
        in al, dx   ;从数据端口输入数据
;查询输出接口
mov dx, 5001h       ;DX指向状态端口
STATUS: in al, dx   ;读状态端口
        test al, 80h;测试标志位D7
        jnz STATUS  ;D7＝1，未就绪，继续查询
        inc dx      ;D7＝0，就绪，DX指向数据端口
        mov al, buf ;变量buf送AL
        out dx, al  ;将数据输出给数据端口
```

什么是中断，什么是中断向量，什么是中断向量表

- 中断：是指CPU在正常执行程序的过程中，由于内部/外部事件的触发或由程序的预先安排，引起CPU暂时中断当前正在运行的程序，而转去执行为内部/外部事件或程序预先安排的事件的服务子程序，待中断服务子程序执行完毕后，CPU再返回到被暂时中断的程序处（断点）继续执行原来的程序，这一过程成为中断。
- 中断向量：中断服务程序的入口地址。
- 中断向量表：把系统中所有的中断类型码及其对应的中断向量按一定的规律存放在一个区域内，这个存储区域就叫中断向量表。

**N号中断程序入口地址所在的物理地址＝N×4**

![image-20211212231350234](微机复习.assets\image-20211212231350234.png)

① ICW1 （芯片控制初始化命令字）

② ICW2 （中断类型初始化命令字）

③ ICW3（主/从片初始化命令字）

④ ICW4（ 方式控制初始化控制字） ICW1的D0为1时

![image-20211213001701616](微机复习.assets\image-20211213001701616.png)

![image-20211213001627520](微机复习.assets\image-20211213001627520.png)

卷后有附录 主要就是看转成2进制后对应状态位为0/1

![image-20211213001801184](微机复习.assets\image-20211213001801184.png)



习题8.4（重点！）

![image-20211213013344248](微机复习.assets\image-20211213013344248.png)

试按如下要求分别编写8253的初始化程序,已知8253的计数器0 ~ 2和控制字I/O地址依次为204H～207H。

(1)使计数器1工作在方式0，仅用8位二进制计数，计数初值为128。

```assembly
mov al, 50h		;01 01 000 0h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov al, 128		;计数初值128写入 只写低字节 因为128 = 80h 只占低字节
mov dx, 205h	;计数器1地址为205h
out dx, al
```

(2)使计数器0工作在方式1，按BCD码计数，计数值为3000。

00 11 001 1	, 	3000h占两字节故为11

```assembly
mov al, 33h		;00 11 001 1h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov ax, 3000h	;计数初值3000h
mov dx, 204h	;计数器0地址为204h
out dx, al		;先写低字节
mov al, ah		
out dx, al		;再写高字节
```

(3)使计数器2工作在方式2，计数值为02F0H。

10 11 010 0， 02F0h占俩字节

```assembly
mov al, 0b4h		;10 11 010 0h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov ax, 02f0h	;计数初值02F0H
mov dx, 206h	;计数器2地址为204h
out dx, al		;先写低字节
mov al, ah		
out dx, al		;再写高字节
```

# 第5章 主存储器

- 随机存取存储器**RAM**：可读可写、**断电丢失**

- 只读存储器**ROM**：正常只读、**断电不丢失**

![image-20211212221257422](微机复习.assets\image-20211212221257422.png)

## 半导体存储器芯片的结构

![半导体存储器芯片的结构](微机复习.assets\image-20211212221339880.png)

## 存储矩阵(重点 存储容量计算)

每个存储单元具有一个唯一的地址，可存储1位（位片结构）或多位（字片结构）二进制数据

存储容量与地址、数据引脚个数有关：

**芯片的存储容量＝存储单元数×存储单元的位数＝2^M^×N**

  **M**：芯片的**地址引脚个数**

   **N**：芯片的**数据引脚个数** 

## 读写控制

**片选信号：芯片选中CS* 、芯片允许 CE***

- 有效时，可以对该芯片进行读写操作

- 无效时，不能读写，功耗低

**读控制信号：输出允许OE***

- 有效时，芯片内数据读出

- 对应存储器读信号MEMR*

**写控制信号：写入允许WE***

- 有效时，数据进入芯片

- 对应存储器写信号MEMW*

## 半导体存储器的连接

![半导体存储器的连接](微机复习.assets\image-20211212222353481.png)

## 地址译码

存储器芯片与微处理器的连接

- 存储器芯片有数据、地址、读写控制引脚

- 处理器总线有数据、地址、读写控制信号

- 功能上**多数可以直接相连**

但是，**地址信号需要译码**

- **处理器地址总线个数多于存储器地址引脚个数**

- 多个存储器芯片组成一定容量的存储系统

- 需要**利用地址总线控制存储器片选信号**

译码（Decode）

- 将某个特定的编码输入翻译为有效输出的过程

存储器译码电路

- 可编程逻辑器件PLD

- 译码器

- 门电路组合

## 存储容量的扩充（重点！）

**同样存储结构的芯片构成一定容量的存储器模块**

![image-20211212222806552](微机复习.assets\image-20211212222806552.png)

64K×1存储结构的芯片构成512KB存储器模块

![image-20211212222838079](微机复习.assets\image-20211212222838079.png)



## 习题5-8（重点！）

利用6264芯片（容量8K×8位的SRAM),采用全译码方式,在8088系统的内存区段40000H～43FFFH扩充RAM区,请画出这些芯片与最大组态的系统总线（参看图4.5)的连接示意图。

解答：①根据地址范围算出目标容量，即算出有多少根地址线、需要几块芯片



# 第7章

## 内部中断

内部中断的原因是处理器执行程序出现异常，所以经常被称为异常
中断向量号
0 除法错中断
1 单步中断
3 断点中断
4 溢出中断

## 外部中断
2 非屏蔽中断 信号NMI
可屏蔽中断 向量号来自外部中断控制器
请求和响应信号分别是INTR和INTA*；

### IF标志控制可屏蔽中断是否允许响应
IF = 0 不响应
- 关中断、禁止中断、中断屏蔽
- 系统复位，使IF＝0
- 任何一个中断被响应，使IF＝0
- 执行指令CLI，使IF＝0
IF = 1 可被响应
- 开中断、允许中断、中断开放
- 执行指令STI，使IF＝1
执行指令IRET恢复原IF状态
## 中断向量表
- 中断服务程序的**入口地址（首地址）**
- 逻辑地址含有**段地址CS**和**偏移地址IP**（32位）
- 每个中断向量的低字是偏移地址、高字是段地址，需占用4个字节
- 8088微处理器**从物理地址000H开始**，依次安排各个中断服务程序入口地址，**向量号也从0开始**
- 256个中断占用1KB区域，就形成中断向量表
- 故，**N号中断程序入口地址所在的物理地址＝N×4**

编写内部中断服务程序与编写子程序类似

- 利用过程定义**伪指令PROC/ENDP**
- 第1条指令通常为**开中断指令STI**
- 最后用**中断返回指令IRET**
- 通常采用寄存器传递参数

主程序需要调用中断服务程序

- 调用前，需要**设置中断服务程序入口地址**
- **设置必要的入口参数**
- 利用**INT N**指令调用中断服务程序
- **处理出口参数**

### 例7.1 编写80H号中断服务程序

编写80H号中断服务程序并调用功能：具有显示以“0”结尾字符串的功能，利用显示器功能调用INT 10H实现字符显示

字符串缓冲区首地址为入口参数：DS:DX（段地址：偏移地址）传递参数

**获取中断程序入口地址（DOS功能调用INT 21H）**

**功能号：AH＝35H**

**入口参数：AL＝中断向量号**

**出口参数：ES:BX＝中断程序入口段地址：偏移地址**

```assembly
;数据段
intoff	dw ?	;用于保存偏移地址
intseg	dw ? 	;用于保存段基地址
intmsg	db ‘A Instruction Interrupt !’, 0dh,0ah,0
;代码段
mov ax,3580h	;利用DOS功能35H号
int 21h	；获取原80H中断程序入口地址
mov intoff,bx	;保存偏移地址
mov intseg,es	;保存段基地址
```

**设置新中断向量**

**设置中断程序入口地址（INT 21H）**

**功能号：AH＝25H**

**入口参数：AL＝中断向量号**

**DS:DX＝中断程序入口段地址：偏移地址**

```assembly
push ds
mov dx, offset new80h	;取中断程序偏移地址
mov ax, seg new80h		;取中断程序段地址
mov ds, ax
mov ax, 2580h
int 21h
pop ds
```

**中断调用**

```assembly
;设置入口参数：	DS＝段地址（已设置）
mov dx,offset intmsg	;DX＝偏移地址
int 80h	；调用80H中断服务程序
```

**主程序返回**

```assembly
mov dx,intoff	;恢复原中断程序入口地址
mov ax,intseg
mov ds,ax	;改变DS
mov ax,2580h
int 21h	;因紧接着返回DOS
mov ax,4c00h	;故无需恢复DS
int 21h
```

## 8259A中断控制器

### 中断控制

中断请求寄存器IRR

- 保存8条外界中断请求信号IR0～IR7的请求状态

- Di位为1表示IRi引脚有中断请求；为0表示无请求

中断服务寄存器ISR

- 保存正在被8259A服务着的中断状态

- Di位为1表示IRi中断正在服务中；为0表示没有被服务

中断屏蔽寄存器IMR

- 保存对中断请求信号IR的屏蔽状态

- Di位为1表示IRi中断被屏蔽（禁止）；为0表示允许

### 

![image-20211212224413127](微机复习.assets\image-20211212224413127.png)

## 状态字（重点！）

### 1、初始化命令字ICW

ICW1~ICW4，其中ICW1和ICW2是必须送的，而ICW3、4是由ICW1的有关位决定

① ICW1 （芯片控制初始化命令字）

-  是8295A第一个写入的命令字。写入条件是8295A地址引脚的A~0~ = 0 以及ICW1的D~4~ = 1。

- D~0~表示需不需要写入ICW4

  ![image-20211212230037909](微机复习.assets\image-20211212230037909.png)

② ICW2 （中断类型初始化命令字）

![image-20211212230202781](微机复习.assets\image-20211212230202781.png)

③ ICW3（主/从片初始化命令字）

![image-20211212230402455](微机复习.assets\image-20211212230402455.png)

④ ICW4（ 方式控制初始化控制字）

![方式控制初始化控制字ICW4](https://img-blog.csdnimg.cn/20190102193043895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2OTQ1NTky,size_16,color_FFFFFF,t_70)

### 2、操作命令字OCW

![image-20211212230558431](微机复习.assets\image-20211212230558431.png)

无顺序，需要哪个写哪个

OCW1为屏蔽命令字，内容写入IMR

OCW2为中断结束和优先权循环命令字

OCW3为屏蔽和读状态命令字

### 3、读取状态字

为了解8259A的工作状态，CPU可读出IRR，ISR和IMR三个寄存器的内容，还有一个查询字。OCW3中RR和RIS位设定读取IRR和ISR。而A引脚为高电平时读取的都是IMR。CPU内部禁止中断时，或者不想用INT引脚向CPU申请中断时，我们可以通过查询字获知外界的中断请求情况。在OCW3中，使P=1发出查询命令。8259A得到查询命令后，立即组成查询字，等待CPU来读取。所以，CPU执行下一条输入指令时(A~0~=0)，便可读得查询字。在查询字中，如果I位为1，表示有外设请求中断，而W~2~ ~ W~0~的编码（其编码规则同ID~2~ ~ ID~0~)表明当前中断请求的最高优先权。I=0说明无外设请求中断。

### 题目（重点！！）

![image-20211213001701616](微机复习.assets\image-20211213001701616.png)

![image-20211213001627520](微机复习.assets\image-20211213001627520.png)

卷后有附录 主要就是看转成2进制后对应状态位为0/1

![image-20211213001801184](微机复习.assets\image-20211213001801184.png)

# 第8章 定时计数控制接口

## 定时功能的实现方法

软件延时

- 利用微处理器执行一个延时程序段实现

- 不用硬件，但占用CPU时间、定时精度不高，随系统时钟频率改变

不可编程的硬件定时

-  采用分频器、单稳电路或简易定时电路控制定时时间

- 定时电路简单、定时时间可以在一定范围改变

可编程的硬件定时

- 软件硬件相结合、用可编程定时器芯片构成一个方便灵活的定时电路

- 具有多种工作方式、能够输出多种控制信号

## 8253/8254定时计数器

- 3个独立的16位计数器通道

- 每个计数器有6种工作方式

- 按二进制或十进制（BCD码）计数
- 8254是8253的改进型

内部结构和引脚如下

![image-20211213002058902](微机复习.assets\image-20211213002058902.png)



### 计数器

- 计数初值存于预置寄存器；

- 在计数过程中，减法计数器的值不断递减，而预置寄存器中的预置不变。

- 输出锁存器用于写入锁存命令时，锁定当前计数值

![image-20211213002220127](微机复习.assets\image-20211213002220127.png)

计数器的三个引脚如下：

- **CLK时钟输入信号** 在计数过程中，此引脚上每输入一个时钟信号（下降沿），计数器的计数值减1
- **GATE门控输入信号** 控制计数器工作，可分成电平控制和上升沿控制两种类型
- **OUT计数器输出信号** 当一次计数过程结束（计数值减为0），OUT引脚上将产生一个输出信号

### 与处理器接口

- D0 ~ D7数据线
- A0 ~ A1地址线
- CS*片选信号
- RD*读信号
- WR*写信号

### 工作方式

8253有6种工作方式，由方式控制字确定

熟悉每种工作方式的特点才能根据实际应用问题，选择正确的工作方式

每种工作方式的过程类似：

- ⑴ 设定工作方式
- ⑵ 设定计数初值
-  ⑶ 硬件启动 
- ⑷ 计数初值进入减1计数器
- ⑸ 每输入一个时钟计数器减1的计数过程
- ⑹ 计数过程结束

**方式0：计数结束中断**

**方式1：可编程单稳脉冲**

**方式2：频率发生器（分频器）**

**方式3：方波发生器**

**方式4：软件触发选通信号**

**方式5：硬件触发选通信号**

### 编程

8253加电后的工作方式不确定，必须初始化编程，才能正常工作

- 写入控制字

- 写入计数初值

- 读取计数值

![image-20211213002909374](微机复习.assets\image-20211213002909374.png)

**计数值写入计数器各自的I/O地址**

### 定时中断和定时刷新（重点！）

#### 定时中断

- 从阅读初始化程序段，看计数器0作为定时中断的作用

```assembly
mov al, 36h		;36H = 00 11 011 0B
;选择计数器0，先低后高写入计数值，计数器工作方式为方式3，采用2进制计数
out 43h, al		;写入方式控制字
mov al, 0		;计数值为0
out 40h, al		;写入低字节计数值
out 40h, al		;写入高字节计数值
```

- 计数器0：方式3方波发生器，计数值：65536，输出频率为1.19318MHz÷65536＝18.206Hz的方波

- 门控为常启状态，这个方波信号不断产生
- OUT0端接8259A的IRQ0，用作中断请求信号
- 每秒产生18.206次中断请求，或说每隔55ms（54.925493ms）申请一次中断
- DOS系统利用计数器0的这个特点，通过08号中断服务程序实现了日时钟计时功能

#### 定时刷新

- **计数器1：定时刷新**

- 需要重复不断提出刷新请求：**门控总为高，选择方式2或3**
- 2ms内刷新128次，即15.6ms刷新一次：**计数初值为18**

```assembly
mov al, 54h		;54H = 01 01 010 0 B
;计数器1为方式2，只写低8位计数值
out 43h, al
mov al, 18		;计数初值为18
out 41h, al		; 写入计数值
```

#### 习题8.4（重点！）

![image-20211213013344248](微机复习.assets\image-20211213013344248.png)

试按如下要求分别编写8253的初始化程序,已知8253的计数器0 ~ 2和控制字I/O地址依次为204H～207H。

(1)使计数器1工作在方式0，仅用8位二进制计数，计数初值为128。

```assembly
mov al, 50h		;01 01 000 0h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov al, 128		;计数初值128写入 只写低字节 因为128 = 80h 只占低字节
mov dx, 205h	;计数器1地址为205h
out dx, al
```

(2)使计数器0工作在方式1，按BCD码计数，计数值为3000。

00 11 001 1	, 	3000h占两字节故为11

```assembly
mov al, 33h		;00 11 001 1h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov ax, 3000h	;计数初值3000h
mov dx, 204h	;计数器0地址为204h
out dx, al		;先写低字节
mov al, ah		
out dx, al		;再写高字节
```

(3)使计数器2工作在方式2，计数值为02F0H。

10 11 010 0， 02F0h占俩字节

```assembly
mov al, 0b4h		;10 11 010 0h 
mov dx, 207h	;控制字地址为207h
out dx, al
mov ax, 02f0h	;计数初值02F0H
mov dx, 206h	;计数器2地址为204h
out dx, al		;先写低字节
mov al, ah		
out dx, al		;再写高字节
```

# 第10章 并行接口

并行数据传输方式：

- 以计算机的字长，通常是8位、16位或32位为传输单位，**一次传送一个字长的数据**

- 适合于外部设备与微机之间进行近距离、大量和快速的信息交换
  - 例如：微机与并行接口打印机、磁盘驱动器
- 微机系统中最基本的信息交换方法
  - 例如：系统板上各部件之间，接口电路板上各部件之间

##  8255A

具有多种功能的可编程并行接口电路芯片

- 最基本的接口电路：三态缓冲器和锁存器

- 与CPU间、与外设间的接口电路：状态寄存器和控制寄存器

- 端口的译码和控制电路、中断控制电路

共24个外设引脚，分3个端口、2组控制

- 有3个8位数据输入/输出端口：端口A、端口B和端口C，分别简称为A口、B口和C口。
- 它们对外的引线分别是PA7～PA0、PB7～PB0和PC7～PC0。C口可分成两个4位的端口：C口高4位（PC7～PC4）和C口低4位（PC3～PC0）。
- 端口A和端口B都有一个8位数据输入锁存器和一个8位数据输出锁存/缓冲器。端口C有一个8位数据输入缓冲器和一个8位数据输出锁存/缓冲器。

共三种输入输出工作方式

8255A的内部结构和引脚

![image-20211213015802095](微机复习.assets\image-20211213015802095.png)

### 8255A的工作方式&编程 （重点）

#### 方式0：基本输入输出方式

- 适用于无条件传送和查询方式的接口电路
- 适用于三个端口
- A口、C口的高4位、B口、C口的低四位可分别定义为输入或输出，共有四个部分，故共有16种组合。

#### 方式1：选通输入输出方式

- 适用于查询和中断方式的接口电路
- 方式1需借用端口C用做联络信号，同时还具有中断请求和屏蔽功能
- A口、B口作为数据的输入口或输出口，但数据的输入输出要在控制信号的控制下，控制信号由C口的某些位来提供；

#### 方式2：双向选通传送方式

- 适用于双向传送数据的外设
- **只有A口可以工作在这种方式下**

- 适用于查询和中断方式的接口电路
- 方式2将方式1的选通输入输出功能组合成一个双向数据端口，可以发送数据和接收数据

![img](https://img2020.cnblogs.com/blog/1986811/202005/1986811-20200501152838013-349893447.png)

![image-20211213020106183](微机复习.assets\image-20211213020106183.png)

- 初始化编程：一个方式控制字
  - 采用控制I/O地址：A1A0＝11
- 工作过程中：通过数据端口对外设数据进行读写
  - 数据读写利用端口A、B和C的I/O地址，A1A0依次等于00、01、10
- IBM PC/XT机上，端口A、B、C和控制端口的I/O地址为60H、61H、62H和63H

### 1、写入方式控制字

要求：A端口：方式1输入

C端口上半部：输出，C口下半部：输入

B端口：方式0输出

- 则 方式控制字：1 01 1 0 0 0 1B，即B1H

初始化的程序段：

```assembly
mov dx, 0fffeh	;假设控制端口地址为FFFEH
mov al, 0b1h	;方式控制字
out dx, al		;送控制端口
```

## 习题10-8（重点）

![image-20211213022756565](微机复习.assets\image-20211213022756565.png)

**〔习题10.8〕**设一工业控制系统，有四个控制点，分别由四个对应的输入端控制，现用8255A的端口C实现该系统的控制，如图10-22。开关K0～K3打开则对应发光二极管L0～L3亮，表示系统该控制点运行正常；开关闭合则对应发光二极管不亮，说明该控制点出现故障。编写8255A的初始化程序和这段控制程序。

解答：![image-20211213020106183](微机复习.assets\image-20211213020106183.png)

如图，C口高4位为输出 D3 = 0 ，为无条件传送，故A、B方式为0 ，D6、D5、D2为0，D4、D1设为0

本题方式控制字为1 00 × 0 0 × 1，即81h

```assembly
;初始化程序
mov dx, 控制口地址	
mov al, 81h
out dx, al
;控制程序
mov dx, 端口C地址
in al, dx	;读入PC0~PC3
mov cl, 4
shl al, cl	;左移4位
out dx, al	;控制PC4~PC7
mov al, 0fh	
mov dx, 端口C地址
out dx, al	;使L0~L3全亮
```

## 键盘 反转法（重点！！）

反转法识别按键原理为：行线作为控制线接一个输出端口，列线作为检测线接一个输入端口，CPU通过输出端口将行线全部设置为低电平，从输入端读取列线，若有键被按下，则必会使某列线为0，然后将行列作用互换，即将行线作为检测线接输入端口，列线作为控制线接输出端口，读刚刚所得的列值和行线输入值，按下的键行列必为0

人言：先将行线接输出，列接输入，行输出全0，读列线，若全1则无键按下，否则有键按下

然后将列线接输出，行接输入，将刚刚读的列值输出，读取行线值，则闭合键位于行列值都为0的地方
